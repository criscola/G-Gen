{{define "title"}}GGen &#8212; Generator{{end}}
{{define "head"}}
<link rel="stylesheet" type="text/css" href="../assets/css/slick.css">
<link rel="stylesheet" type="text/css" href="../assets/css/slick-theme.css">
<link rel="stylesheet" href="../assets/css/dropzone.css">

<script src="../assets/js/slick.js" type="text/javascript"></script>
<script src="../assets/js/dropzone.js" type="text/javascript"></script>
<script src="../assets/js/js.cookie.js"></script>
<script src="../assets/js/fabric.min.js"></script>

<script type="text/javascript">
    $(document).ready(function() {
        $(".generatorForm").slick({
            lazyLoad: 'ondemand', // ondemand progressive anticipated
            infinite: false,
            draggable: false,
            swipe: false,
            swipeToSlide: false,
            touchMove: false,
            draggable: false,
        });
        $('#forwardToGeneralSettings').click(function() {
            $(".generatorForm").slick("slickGoTo", 1);
        });
        $('#forwardToImageSettings').click(function() {
            $(".generatorForm").slick("slickGoTo", 2);
        });
        $('#forwardToPrinterSettings').click(function() {
            $(".generatorForm").slick("slickGoTo", 3);
        });
        $('#forwardToLoadingScreen').click(function() {
            // Open transmission with server
            // Send data to the server
            // Receive informations about elaboration and modify loading bar accordingly
            // When finished, receive final G-Code location in server (which will be delete after user exited webpage) so that
            // the viewer can load it
            // Close transmission
            // Go to next slide
            // Reset data for loading slide
            $(".generatorForm").slick("slickGoTo", 4);
            // Debug only
            setTimeout(
                function() 
                {
                    $(".generatorForm").slick("slickGoTo", 5);
                }, 1500);
            
        });
        $('#forwardToPreview').click(function() {
            $(".generatorForm").slick("slickGoTo", 5);
        });
        $('#restartForm').click(function() {
            $(".generatorForm").slick("slickGoTo", 1);
        });
        $('#makeAnotherModel').click(function() {
            // Cancel all data
            $(".generatorForm").slick("slickGoTo", 0);
        });
        $('#backToImageUpload').click(function() {
            $(".generatorForm").slick("slickGoTo", 0);
        });
        $('#backToGeneralSettings').click(function() {
            $(".generatorForm").slick("slickGoTo", 1);
        });
        $('#backToImageSettings').click(function() {
            $(".generatorForm").slick("slickGoTo", 2);
        });
        $('#backToPrinterSettings').click(function() {
            $(".generatorForm").slick("slickGoTo", 3);
        });
    });

    Dropzone.options.imageUpload = {
        paramName: "image", // The name that will be used to transfer the file
        maxFilesize: 5, // MB
        maxFiles: 1,
        success: function(file, response){
            // codice...
        }
    };

    // reference canvas element (with id="c")
    var canvas = document.getElementById('c');

    fabric.Image.fromURL('uploads/test.jpg', function(img) {
        // add filter
        img.filters.push(new fabric.Image.filters.Grayscale());

        // apply filters and re-render canvas when done
        img.applyFilters();
        // add image onto canvas (it also re-render the canvas)
        canvas.add(img);
    });
</script>

{{end}}
{{define "content"}}
    <section class="generatorForm">
        <div>
            <fieldset>
                <legend class="slideTitle">Upload image</legend>
                <canvas id="c"></canvas>
                <!-- Drag & drop image -->
                <div id="imageUploadContainer">
                    <form action="generator/imageUpload" id="imageUpload" class="dropzone" enctype="multipart/form-data" method="POST"> </form>
                </div>
                <div id="controlForm"></div>
                </div>
                <div>
                    <button id="forwardToGeneralSettings" type="button">Next</button>
                </div>
            </fieldset>
        </div>
        <form action="/generator/generate" method="POST">
            <div>
                <fieldset>
                    <legend class="slideTitle">General settings</legend>
                    <button id="backToImageUpload" type="button">Back</button>
                    <button id="forwardToImageSettings" type="button">Next</button>
                </fieldset>
            </div>
            <div>
                <fieldset>
                    <legend class="slideTitle">Image settings</legend>
                <div class="box__uploading">Uploading&hellip;</div>
                <div class="box__success">Done!</div>
                <div class="box__error">Error! <span></span>.</div>
                    <button id="backToGeneralSettings" type="button">Back</button>
                    <button id="forwardToPrinterSettings" type="button">Next</button>
                </fieldset>
            </div>
            <div>
                <fieldset>
                    <legend class="slideTitle">Printer settings</legend>
                    <button id="backToImageSettings" type="button">Back</button>
                    <button id="forwardToLoadingScreen" type="button">Generate!</button>
                </fieldset>
            </div>
        </form>
        <div>
            <p style="text-align:center;">Please wait...</p>
        </div>
        <div>
            <fieldset>
                <legend class="slideTitle">Preview</legend>
                <button id="restartForm" type="button">Remake it</button>
                <button id="makeAnotherModel" type="button">Another one</button>
            </fieldset>
        </div>
    </section>
{{end}}